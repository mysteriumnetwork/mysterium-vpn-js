stages:
  - build
  - publish

image:
  name: node:lts-alpine

build:
  stage: build
  tags: [docker]
  script: yarn ci
  artifacts:
    paths:
      - lib/

publish-npm:
  stage: publish
  only:
    - tags
  tags: [docker]
  variables:
    GIT_CLONE_PATH: ""
  script:
    - echo '//registry.npmjs.org/:_authToken=${NPM_PUBLISH_TOKEN}'>.npmrc
    - npm publish --access public
